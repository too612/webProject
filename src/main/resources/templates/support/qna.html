<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<head>
    <title>대전청소년위캔센터 - 질문과답변</title>
    <th:block layout:fragment="css">
        <style>
            /* Q&A 페이지 전용 스타일 */
            .qna-content-header {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                padding-bottom: 20px;
                border-bottom: 1px solid #e9ecef;
                margin-bottom: 20px;
            }
            .qna-content-header h2 {
                margin: 0;
                font-size: 24px;
                font-weight: 600;
            }
            .breadcrumb-right {
                font-size: 14px;
                color: #6c757d;
                padding-top: 8px;
            }
            .status-badge {
                display: inline-block;
                padding: 3px 8px;
                font-size: 12px;
                font-weight: 600;
                border-radius: 12px;
                color: white;
                background-color: #4CAF50; /* 답변 완료 (녹색) */
                margin-right: 8px;
                vertical-align: middle;
            }
            .table-container {
                overflow-x: auto;
            }
            table {
                width: 100%;
                border-collapse: collapse;
            }
            th, td {
                padding: 16px;
                text-align: left;
                border-bottom: 1px solid #e0e0e0;
            }
            th {
                background: #f8f9fa;
                font-weight: 600;
            }
            .post-title {
                font-weight: 500;
            }
            .post-title:hover {
                color: #2196F3;
            }
            .pagination {
                display: flex;
                justify-content: center;
                padding: 30px 0;
                gap: 5px;
            }
            .pagination a {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 40px;
                height: 40px;
                color: #666;
                border: 1px solid #e0e0e0;
                border-radius: 6px;
                transition: all 0.2s;
            }
            .pagination a:hover {
                background: #f5f5f5;
            }
            .pagination a.active {
                background: #2196F3;
                color: white;
                border-color: #2196F3;
            }
            .search-area {
                border-top: 1px solid #e0e0e0;
                background: #f8f9fa;
                display: flex;
                justify-content: center;
                gap: 10px;
                /* content-area의 padding(-30px) 만큼 확장하여 꽉 채움 */
                margin: 0 -30px -30px; 
                padding: 20px 30px;
            }
            .search-select, .search-input {
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 6px;
            }
            .search-input { width: 250px; }
            .search-btn {
                padding: 10px 20px;
                background: #2196F3;
                color: white;
                border: none;
                border-radius: 6px;
                cursor: pointer;
            }
        </style>
    </th:block>
</head>
<body>
    <!-- layout.html의 content 프래그먼트에 삽입될 내용 -->
    <div layout:fragment="content">
        <!-- 메시지 표시 영역 -->
        <div th:if="${message}" class="alert alert-info" role="alert" style="margin-bottom: 20px; padding: 15px; background-color: #d1ecf1; border: 1px solid #bee5eb; border-radius: 4px;">
            <p th:text="${message}" style="margin: 0;"></p>
        </div>

        <div class="qna-content-header">
            <div>
                <h2>질문과 답변</h2>
                <div class="content-stats" th:if="${!paging.isEmpty()}">게시물 수: <span th:text="${paging.totalElements}">0</span> | 페이지: <span th:text="${paging.number + 1}">0</span>/<span th:text="${paging.totalPages}">0</span></div>
            </div>
            <div class="breadcrumb-right" style="display: none;"> <!-- breadcrumb은 공통 레이아웃에서 처리하므로 숨김 -->
                <a href="#">홈</a> > <a href="#">열린마당</a> > 질문과답변
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th style="width: 10%;">번호</th>
                        <th style="width: 10%; display: none;">Key</th>
                        <th>제목</th>
                        <th style="width: 15%;">작성자</th>
                        <th style="width: 15%;">등록일</th>
                    </tr>
                </thead>
                <tbody th:if="${!#lists.isEmpty(boards)}">
                    <!-- iterStat을 사용하여 반복 상태(index 등)에 접근 -->
                    <tr th:each="board, iterStat : ${boards}">
                        <!-- 전체 게시물 수에서 (현재페이지 * 페이지사이즈 + 현재 index)를 빼서 역순 번호 계산 -->
                        <td th:text="${paging.totalElements - (paging.number * paging.size) - iterStat.index}">번호</td>
                        <td th:text="${board.rqstNo}" style="display: none;">Key</td>
                        <td>
                            <a th:href="@{/support/qna/write(rqstNo=${board.rqstNo})}" class="post-title" th:text="${board.title}">
                                게시글 제목
                            </a>
                            <!-- 답변 여부(ansYn)에 따라 답변 완료 배지를 표시하는 로직 (필요시 주석 해제) -->
                            <!-- <span th:if="${board.ansYn == 'Y'}" class="status-badge">답변</span> -->
                        </td>
                        <td th:text="${board.rqstId}">작성자</td>
                        <td th:text="${board.insDt != null ? #temporals.format(board.insDt, 'yyyy-MM-dd') : ''}">2025-01-01</td>
                    </tr>
                </tbody>
                <tbody th:if="${#lists.isEmpty(boards)}">
                    <tr>
                        <td colspan="4" style="text-align: center;">게시글이 없습니다.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination" th:if="${!paging.isEmpty()}">
            <!--/*
                페이지네이션 로직:
                - paging: Spring Data의 Page 객체
                - number: 현재 페이지 (0부터 시작)
                - totalPages: 전체 페이지 수
                - size: 페이지당 보여줄 항목 수 (여기서는 10으로 가정)
            */-->
            <!-- 처음으로 이동 -->
            <a th:href="@{/support/qna(page=0, searchType=${param.searchType}, keyword=${param.keyword})}" th:if="${paging.number > 0}"><span>&laquo;</span></a>
            <!-- 이전 블록으로 이동 -->
            <a th:href="@{/support/qna(page=${(paging.number/10)*10 - 1}, searchType=${param.searchType}, keyword=${param.keyword})}" th:if="${paging.number >= 10}"><span>&lt;</span></a>
        
            <!-- 페이지 번호 -->
            <a th:each="page: ${#numbers.sequence( (paging.number/10)*10 + 1, T(java.lang.Math).min((paging.number/10)*10 + 10, paging.totalPages) )}"
               th:href="@{/support/qna(page=${page - 1}, searchType=${param.searchType}, keyword=${param.keyword})}"
               th:text="${page}"
               th:classappend="${page == paging.number + 1} ? 'active' : ''"></a>
        
            <!-- 다음 블록으로 이동 -->
            <a th:href="@{/support/qna(page=${(paging.number/10)*10 + 10}, searchType=${param.searchType}, keyword=${param.keyword})}" th:if="${(paging.number/10)*10 + 10 < paging.totalPages}"><span>&gt;</span></a>
            <!-- 마지막으로 이동 -->
            <a th:href="@{/support/qna(page=${paging.totalPages - 1}, searchType=${param.searchType}, keyword=${param.keyword})}" th:if="${paging.number < paging.totalPages - 1}"><span>&raquo;</span></a>
        </div>

        <div class="search-area">
            <select id="searchType" class="search-select" name="searchType">
                <option value="title" th:selected="${param.searchType == 'title'}">제목</option>
                <option value="cont" th:selected="${param.searchType == 'cont'}">내용</option>
                <option value="rqstId" th:selected="${param.searchType == 'rqstId'}">작성자</option>
            </select>
            <input id="keyword" type="text" class="search-input" placeholder="검색어를 입력하세요" name="keyword" th:value="${param.keyword}">
            <button class="search-btn" id="search">검색</button>
            <button class="search-btn" id="write">글쓰기</button>
        </div>
    </div>

    <th:block layout:fragment="scripts">
        <script>
            // 페이지네이션, 검색 등 이 페이지에만 필요한 스크립트
            document.getElementById('search').addEventListener('click', function() {
                const searchType = document.getElementById('searchType').value;
                const keyword = document.getElementById('keyword').value;

                if (!keyword.trim()) {
                    alert('검색어를 입력해주세요.');
                    return;
                }

                location.href = '/support/qna?searchType=' + searchType + '&keyword=' + encodeURIComponent(keyword);
            });

            document.getElementById('write').addEventListener('click', function() {
                location.href = '/support/qna/write';
            });
        </script>
    </th:block>
</body>
</html>